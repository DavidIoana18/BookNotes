<%- include('partials/header') %> 

<% if (books.length > 0) { %> 
    <h1 class="h1-myBooks">Welcome to <%= user.first_name %>'s BookHub</h1>
    <div class="books">
        <form action ="/filterBooks" method="GET" class="filter-form">
            <input type="hidden" name="userId" value="<%= user.id %>">
            <label for="sortByTitle">Title:</label>
            <select name="sortByTitle" id="sortByTitle" class="titleSort">
                <option value="">Select</option>
                <option value="ASC">A-Z</option>
                <option value="DESC">Z-A</option>
            </select>
    
            <label for="sortByRating">Rating:</label>
             <select name="sortByRating" id="sortByRating" class="ratingSort">
                <option value="">Select</option>
                <option value="ASC">Low to High</option>
                <option value="DESC">High to Low</option>
            </select>
    
            <label for="sortByGenre">Genre:</label>
            <select name="sortByGenre" id="sortByGenre" class="genreSort">
                <option value="">Select</option>
                <optgroup label="Arts">
                    <option value="Architecture">Architecture</option>
                    <option value="Art Instruction">Art Instruction</option>
                    <option value="Art History">Art History</option>
                    <option value="Dance">Dance</option>
                    <option value="Design">Design</option>
                    <option value="Fashion">Fashion</option>
                    <option value="Film">Film</option>
                    <option value="Graphic Design">Graphic Design</option>
                    <option value="Music">Music</option>
                    <option value="Music Theory">Music Theory</option>
                    <option value="Painting">Painting</option>
                    <option value="Photography">Photography</option>
                </optgroup>
    
                <optgroup label="Animals">
                    <option value="Bears">Bears</option>
                    <option value="Cats">Cats</option>
                    <option value="Dogs">Dogs</option>
                </optgroup>
    
                <optgroup label="Fiction">
                    <option value="Fantasy">Fantasy</option>
                    <option value="Historical Fiction">Historical Fiction</option>
                    <option value="Horror">Horror</option>
                    <option value="Humor">Humor</option>
                    <option value="Literature">Literature</option>
                    <option value="Magic">Magic</option>
                    <option value="Mystery and Detective Stories">Mystery and Detective Stories</option>
                    <option value="Plays">Plays</option>
                    <option value="Poetry">Poetry</option>
                    <option value="Romance">Romance</option>
                    <option value="Science Fiction">Science Fiction</option>
                    <option value="Short Stories">Short Stories</option>
                    <option value="Thriller">Thriller</option>
                    <option value="Young Adult">Young Adult</option>
                </optgroup>
    
                <optgroup label="Science & Mathematics">
                    <option value="Biology">Biology</option>
                    <option value="Chemistry">Chemistry</option>
                    <option value="Mathematics">Mathematics</option>
                    <option value="Physics">Physics</option>
                    <option value="Programming">Programming</option>
                </optgroup>
    
                <optgroup label="Business & Finance">
                    <option value="Management">Management</option>
                    <option value="Entrepreneurship">Entrepreneurship</option>
                    <option value="Business Economics">Business Economics</option>
                    <option value="Business Success">Business Success</option>
                    <option value="Finance">Finance</option>
                </optgroup>
    
                <optgroup label="History">
                    <option value="Ancient Civilization">Ancient Civilization</option>
                    <option value="Archaeology">Archaeology</option>
                    <option value="Anthropology">Anthropology</option>
                    <option value="World War II">World War II</option>
                    <option value="Social Life and Customs">Social Life and Customs</option>
                </optgroup>
    
                <optgroup label="Health & Wellness">
                    <option value="Cooking">Cooking</option>
                    <option value="Cookbooks">Cookbooks</option>
                    <option value="Mental Health">Mental Health</option>
                    <option value="Exercise">Exercise</option>
                    <option value="Nutrition">Nutrition</option>
                    <option value="Self-help ">Self-help </option>
                </optgroup>
    
                <optgroup label="Biography">
                    <option value="Autobiographies">Autobiographies</option>
                    <option value="History">History</option>
                    <option value="Politics and Government">Politics and Government</option>
                    <option value="World War II">World War II</option>
                    <option value="Women">Women</option>
                    <option value="Kings and Rulers">Kings and Rulers</option>
                    <option value="Composers">Composers</option>
                    <option value="Artists">Artists</option>
                </optgroup>
                
                <optgroup label="Social Sciences">
                    <option value="Anthropology">Anthropology</option>
                    <option value="Religion">Religion</option>
                    <option value="Political Science">Political Science</option>
                    <option value="Psychology">Psychology</option>
                </optgroup>
                
                <optgroup label="Places">
                    <option value="Brazil">Brazil</option>
                    <option value="India">India</option>
                    <option value="Indonesia">Indonesia</option>
                    <option value="United States">United States</option>
                </optgroup>
                
                <optgroup label="Textbooks">
                    <option value="History">History</option>
                    <option value="Mathematics">Mathematics</option>
                    <option value="Geography">Geography</option>
                    <option value="Psychology">Psychology</option>
                    <option value="Algebra">Algebra</option>
                    <option value="Education">Education</option>
                    <option value="Business & Economics">Business & Economics</option>
                    <option value="Science">Science</option>
                    <option value="Chemistry">Chemistry</option>
                    <option value="English Language">English Language</option>
                    <option value="Physics">Physics</option>
                    <option value="Computer Science">Computer Science</option>
                </optgroup>
                
    
                <optgroup label="Books by Language">
                    <option value="English">English</option>
                    <option value="French">French</option>
                    <option value="Spanish">Spanish</option>
                    <option value="German">German</option>
                    <option value="Russian">Russian</option>
                    <option value="Italian">Italian</option>
                    <option value="Chinese">Chinese</option>
                    <option value="Science">Science</option>
                    <option value="Chemistry">Chemistry</option>
                    <option value="Japanese">Japanese</option>
                    <option value="Swedish ">Swedish </option>
                    <option value="Romanian ">Romanian </option>
                </optgroup>
    
                <option value="Other">Other</option>
            </select>
    
            <button type="submit">Sort</button>
            <button type="button" onclick="resetFilters()">Reset</button>
        </form>

        <div class="books-container">
            <% books.forEach(book => { %>
                <div class="book-card">
                    <img src="<%= book.cover_url %>" alt="Book Cover">
                    <h2 class="book-title"><%= book.title %></h2>
                    <p class="book-author"><%= book.author %></p>
                    <div class="rating">
                        <% for (let i = 1; i <= 5; i++) { %>
                            <span><%= i <= book.rating ? '★' : '☆' %></span>
                        <% } %>
                    </div>
                    <a href="/follower/bookDetails/<%= book.id %>/<%= user.id %>">
                        <button>View Details</button>
                    </a>
                </div>
            <% }) %>
        </div>
<% } else { %>
    <div class="no-books-container">
        <p>It seems like <%= user.first_name %> <%= user.last_name %> hasn't added any books yet.</p>
    </div>
<% } %>
</div>

<script>
    // Remove the name attribute from the select elements that have no value, so they won't be sent to the server
    document.querySelector(".filter-form").addEventListener("submit", function(event) { // If the form is submitted
        const selects = this.querySelectorAll("select"); // Get all select elements
        let hasSelection = false; // Initialize a variable to check if the user selected at least one option

        selects.forEach(select => {
            if (select.value) {  // If the select element has a value (user selected an option)
                hasSelection = true; 
            }else{
                select.removeAttribute("name"); // Remove the name attribute, so the URL won't have the query string for that select element
            }
        });

        if (!hasSelection) {
            event.preventDefault(); // Prevent the form from being submitted
        }
    });

    // Reset the filters
    function resetFilters() {
        window.location.href = "/follower/books/<%= user.id %>";  // Redirect to the same page
    }
</script>

<%- include('partials/footer') %>
